{"filename":"src/lib/network_pool/map_set.ml","lines":[{"line":"(** Utilities for dealing with \"multimaps\" or mapsets. *)","counters":[]},{"line":"","counters":[{"col_start":0,"col_end":0,"count":1}]},{"line":"open Core","counters":[]},{"line":"","counters":[]},{"line":"(** A map from 'ks to sets of 'vs, using the provided comparators. *)","counters":[]},{"line":"type ('k, 'v, 'cmpS, 'cmpM) t = ('k, ('v, 'cmpS) Set.t, 'cmpM) Map.t","counters":[]},{"line":"","counters":[]},{"line":"(** Remove an element from a mapset. *)","counters":[]},{"line":"let remove_exn :","counters":[]},{"line":"    ('k, 'v, 'cmpS, 'cmpM) t -> 'k -> 'v -> ('k, 'v, 'cmpS, 'cmpM) t =","counters":[]},{"line":" fun map k v ->","counters":[]},{"line":"  let newset = Map.find_exn map k |> Fn.flip Set.remove v in","counters":[{"col_start":2,"col_end":2,"count":0},{"col_start":26,"col_end":26,"count":0}]},{"line":"  if Set.is_empty newset then Map.remove map k","counters":[{"col_start":2,"col_end":2,"count":0},{"col_start":30,"col_end":30,"count":0}]},{"line":"  else Map.set map ~key:k ~data:newset","counters":[{"col_start":7,"col_end":7,"count":0}]},{"line":"","counters":[]},{"line":"(* Add an element to a mapset. *)","counters":[]},{"line":"let insert :","counters":[]},{"line":"       ('v, 'cmpS) Set.comparator","counters":[]},{"line":"    -> ('k, 'v, 'cmpS, 'cmpM) t","counters":[]},{"line":"    -> 'k","counters":[]},{"line":"    -> 'v","counters":[]},{"line":"    -> ('k, 'v, 'cmpS, 'cmpM) t =","counters":[]},{"line":" fun comparator map k v ->","counters":[]},{"line":"  Map.change map k ~f:(fun set_opt ->","counters":[{"col_start":2,"col_end":2,"count":0}]},{"line":"      match set_opt with","counters":[{"col_start":6,"col_end":6,"count":0}]},{"line":"      | None ->","counters":[{"col_start":8,"col_end":8,"count":0}]},{"line":"          Some (Set.singleton comparator v)","counters":[{"col_start":28,"col_end":28,"count":0}]},{"line":"      | Some set ->","counters":[{"col_start":8,"col_end":8,"count":0}]},{"line":"          Some (Set.add set v) )","counters":[{"col_start":22,"col_end":22,"count":0},{"col_start":31,"col_end":31,"count":1}]}]}